box: php
build:
  steps:
    - script:
        name: echo
        code: |
          echo "Hello belgian Balloon Club - thanks for the contribution !"
    - install-packages:
        packages: git unzip

deploy:
  steps:
    - install-packages:
        packages: openssh-client rsync git unzip
    - add-to-known_hosts:
        hostname: ftp.cluster006.ovh.net
    - mktemp:
        envvar: PRIVATEKEY_PATH
    - create-file:
        name: write key
        filename: $PRIVATEKEY_PATH
        content: $PRIVATEKEY_FILE_PRIVATE
        overwrite: true
        hide-from-log: true
    - script:
        name: rsync - LX
        code: |-
          rsync -ravz -e "ssh -i $PRIVATEKEY_PATH" -h --stats \
          --update \
          --include 'htdocs/***' \
          --include 'scripts/***' \
          --exclude '*' . belgianb@ftp.cluster006.ovh.net:/homez.577/belgianb/www/intranetlx
    - script:
        name: rsync - BE
        code: |-
          rsync -ravz -e "ssh -i $PRIVATEKEY_PATH" -h --stats \
          --update \
          --include 'htdocs/***' \
          --include 'scripts/***' \
          --exclude '*' . belgianb@ftp.cluster006.ovh.net:/homez.577/belgianb/www/intranet
